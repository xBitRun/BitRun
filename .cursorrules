# Rules

## 0. Workflow
- **Proposal First**: Propose solution -> Wait for approval -> Implement.
- **Docs First**: Check `docs/` for existing patterns before coding. Update docs if arch changes.

## 1. Internationalization (i18n) Standards (CRITICAL)

### General Rules
- **NEVER hardcode user-facing text** in `.tsx` files
- **ALL visible text** must use `useTranslations()` hook from `next-intl`
- Translation files: `frontend/src/messages/zh.json` and `frontend/src/messages/en.json`

### Implementation Pattern
```tsx
// âœ… Correct
import { useTranslations } from "next-intl";

export function MyComponent() {
  const t = useTranslations("myModule");
  return <Button>{t("buttonLabel")}</Button>;
}

// âŒ Wrong
export function MyComponent() {
  return <Button>Click me</Button>;
}
```

### What Must Be Translated
- Button labels, menu items, titles, descriptions
- Toast messages (`toast.success()`, `toast.error()`)
- Error messages, loading states, placeholders
- Form labels, validation messages
- Empty states, fallback text

### What Does NOT Need Translation
- Technical identifiers (IDs, keys)
- URLs, file paths
- Code/debug output
- Currency symbols ($), units (%, x)

### Translation Key Naming
- Use dot notation: `module.section.key`
- Group by feature: `accounts.toast.success`, `agents.error.loadFailed`
- Common keys in `common.*`: `common.loading`, `common.retry`, `common.cancel`

### Adding New Text
1. First add keys to BOTH `zh.json` and `en.json`
2. Then use `t("key")` in component
3. For dynamic content: `t("key", { count: 5 })`

### Checklist Before Commit
- [ ] No hardcoded Chinese text in `.tsx` files
- [ ] No hardcoded English text in `.tsx` files
- [ ] All toast messages use translation keys
- [ ] Error/retry buttons use translation keys
- [ ] Empty states use translation keys

## 2. Documentation Standards
- **Location**: All docs in `docs/` folder. Flat structure.
- **Language**: Simplified Chinese (zh-CN) for content.
- **Style**: Technical specifications (what/how/why), NOT chronological logs.
- **Format**: Clean Markdown. No Jekyll headers. No changelogs inside docs.
- **Process**: Update docs -> Code implementation.

## 3. Git Commit Standards (CRITICAL)
- **Format**: `<emoji> <type>: <ä¸»æ ‡é¢˜>`
- **Emoji Mapping**:
  - âœ¨ `feat`: æ–°åŠŸèƒ½ï¼ˆæ–°å¢åŠŸèƒ½ã€é¡µé¢ã€ç»„ä»¶ï¼‰
  - ğŸ› `fix`: ä¿®å¤ï¼ˆBug ä¿®å¤ï¼‰
  - ğŸ¨ `style`: æ ·å¼ï¼ˆUI æ ·å¼è°ƒæ•´ï¼‰
  - â™»ï¸ `refactor`: é‡æ„ï¼ˆä»£ç é‡æ„ï¼‰
  - ğŸ“ `docs`: æ–‡æ¡£ï¼ˆæ–‡æ¡£æ›´æ–°ï¼‰
  - ğŸ”§ `chore`: é…ç½®ï¼ˆé…ç½®/ä¾èµ–æ›´æ–°ï¼‰
  - âœ… `test`: æµ‹è¯•ï¼ˆæµ‹è¯•ç›¸å…³ï¼‰
  - ğŸš€ `perf`: æ€§èƒ½ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
- **Title Rules**:
  - ä½¿ç”¨ä¸­æ–‡
  - ç®€æ´æ˜äº†ï¼Œä¸è¶…è¿‡ 50 å­—ç¬¦
  - åŠ¨è¯å¼€å¤´ï¼ˆæ–°å¢/ä¿®å¤/ä¼˜åŒ–/è°ƒæ•´/é‡æ„ï¼‰
- **Body Rules**:
  - åˆ—è¡¨å½¢å¼ï¼Œæ¯é¡¹ä»¥ `-` å¼€å¤´
  - è¯´æ˜å…·ä½“æ”¹åŠ¨ç‚¹
- **Examples**:
  ```bash
  âœ¨ feat: æ–°å¢ç”¨æˆ·ç™»å½•åŠŸèƒ½
  âœ¨ feat: æ–°å¢äº¤æ˜“æ¨¡å— UI
  - å®ç° Spot ç°è´§äº¤æ˜“é¢æ¿
  - å®ç° Equities æƒç›Šäº¤æ˜“é¢æ¿
  ğŸ› fix: ä¿®å¤è®¢å•æäº¤å¤±è´¥é—®é¢˜
  - ä¿®æ­£ç­¾åå‚æ•°æ ¼å¼
  ```
- **Requirements**:
  - æ¯æ¬¡æäº¤åªåšä¸€ä»¶äº‹
  - æäº¤å‰ç¡®ä¿ä»£ç å¯è¿è¡Œ
  - ç›¸å…³è”çš„æ”¹åŠ¨åˆå¹¶ä¸ºä¸€æ¬¡æäº¤
  - **ALWAYS** follow this format when making commits

## 4. Testing Standards (CRITICAL)

### è¾¹ç•Œå€¼å¼ºåˆ¶è¦†ç›–
- å¯¹å¸¦çº¦æŸçš„å­—æ®µï¼ˆå¦‚ Pydantic `ge=1`, `le=50`ï¼‰ï¼Œ**å¿…é¡»æµ‹è¯•è¾¹ç•Œå€¼å’Œéæ³•å€¼**
- è¾¹ç•Œå€¼ï¼šçº¦æŸè¾¹ç•Œæœ¬èº«ï¼ˆ1, 50ï¼‰åŠå…¶ä¸¤ä¾§ï¼ˆ0, 51ï¼‰
- éæ³•å€¼ï¼šè´Ÿæ•°ã€é›¶ã€`None`ã€ç©ºå­—ç¬¦ä¸²ã€ç±»å‹é”™è¯¯ç­‰
- ç¤ºä¾‹ï¼š`leverage` å­—æ®µ `ge=1, le=50` â†’ å¿…é¡»è¦†ç›– `0, 1, 50, 51, -1, None`

### æ–­è¨€å¿…é¡»éªŒè¯æ ¸å¿ƒè¡Œä¸º
- **ç¦æ­¢**åªå†™ `assert result is not None` å°±ç»“æŸ
- æ¯ä¸ªæµ‹è¯•å¿…é¡»æ–­è¨€å‡½æ•°çš„**æ ¸å¿ƒè¾“å‡ºå€¼æˆ–å‰¯ä½œç”¨**
- âŒ `assert result is not None  # should clamp leverage`
- âœ… `assert result.decisions[0].leverage == 3  # clamped from 5`

### å¼‚å¸¸è·¯å¾„å¿…é¡»è¦†ç›–
- ä»£ç ä¸­æ¯ä¸ª `except` åˆ†æ”¯éƒ½è¦æœ‰å¯¹åº”çš„æµ‹è¯•ç”¨ä¾‹è§¦å‘å®ƒ
- ç‰¹åˆ«æ³¨æ„ï¼šæ•è·å¤šç§å¼‚å¸¸ç±»å‹æ—¶ï¼ˆå¦‚ `except (ValueError, KeyError, ValidationError)`ï¼‰ï¼Œæ¯ç§å¼‚å¸¸ç±»å‹éƒ½éœ€è¦ç‹¬ç«‹çš„æµ‹è¯•ç”¨ä¾‹

### å¤–éƒ¨è¾“å…¥å¿…é¡»æ¨¡æ‹ŸçœŸå®è„æ•°æ®
- è§£æ AI / ç¬¬ä¸‰æ–¹ API å“åº”çš„ä»£ç ï¼Œæµ‹è¯•æ•°æ®**ä¸èƒ½åªç”¨ç†æƒ³æ ¼å¼**
- å¿…é¡»åŒ…å«çœŸå®åœºæ™¯ä¸­çš„è„æ•°æ®ï¼šç¼ºå¤±å­—æ®µã€ç±»å‹é”™è¯¯ã€è¶Šç•Œå€¼ã€ç©ºå€¼ã€é¢å¤–å­—æ®µ
- ç¤ºä¾‹ï¼šAI å¯¹ hold å†³ç­–è¿”å› `leverage: 0`ï¼ˆè®¤ä¸º"ä¸äº¤æ˜“æ— æ æ†"ï¼‰ï¼Œè¿™ç±»çœŸå®è¡Œä¸ºå¿…é¡»æœ‰æµ‹è¯•è¦†ç›–

### é›†æˆå±‚ä¸æ¨¡å‹å±‚ç‹¬ç«‹æµ‹è¯•
- æ¨¡å‹å±‚ï¼ˆPydantic Modelï¼‰éªŒè¯äº†çº¦æŸ â‰  é›†æˆå±‚ï¼ˆService/Parserï¼‰ä¹Ÿå®‰å…¨
- é›†æˆå±‚éœ€å•ç‹¬æµ‹è¯•ï¼šæ•°æ®ç»è¿‡è½¬æ¢/æ¸…æ´—åæµå…¥æ¨¡å‹æ—¶çš„å®Œæ•´è¡Œä¸º
- é‡ç‚¹å…³æ³¨ï¼šé›†æˆå±‚çš„æ•°æ®é¢„å¤„ç†ï¼ˆclampã€defaultã€è½¬æ¢ï¼‰æ˜¯å¦æ­£ç¡®

### ä¿® Bug å¿…é¡»è¡¥å›å½’æµ‹è¯•
- æ¯æ¬¡ bug fix **å¿…é¡»é™„å¸¦**èƒ½å¤ç°è¯¥ bug çš„æµ‹è¯•ç”¨ä¾‹
- æµ‹è¯•åº”åœ¨ä¿®å¤å‰å¤±è´¥ã€ä¿®å¤åé€šè¿‡ï¼Œç¡®ä¿é—®é¢˜ä¸ä¼šå¤å‘
