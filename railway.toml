# ============================================================
# BITRUN — Railway Backend Service Configuration
# ============================================================
#
# This file configures the BACKEND service on Railway.
# The FRONTEND service should be configured separately in Railway
# Dashboard with Root Directory = /frontend.
#
# Full deployment guide: docs/deployment.md#railway-部署
# Quick deploy script:   ./railway/deploy.sh
#
# Architecture:
#   Railway Project
#   ├── PostgreSQL    (Railway Database — auto-injects DATABASE_URL)
#   ├── Redis         (Railway Database — auto-injects REDIS_URL)
#   ├── Backend       (this config — Dockerfile.railway)
#   └── Frontend      (separate service — frontend/Dockerfile)
#
# Required Environment Variables (Backend):
#   DATABASE_URL        — ${{Postgres.DATABASE_URL}} (Railway reference)
#   REDIS_URL           — ${{Redis.REDIS_URL}} (Railway reference)
#   JWT_SECRET          — python -c "import secrets; print(secrets.token_urlsafe(32))"
#   DATA_ENCRYPTION_KEY — python -c "import secrets; print(secrets.token_urlsafe(32))"
#   ENVIRONMENT         — production
#   CORS_ORIGINS        — https://www.bitrun.ai (多个用逗号分隔，如 https://www.bitrun.ai,https://bitrun.ai)
#
# Required Environment Variables (Frontend):
#   NEXT_PUBLIC_API_URL — https://your-backend.up.railway.app/api
#   NEXT_PUBLIC_WS_URL  — wss://your-backend.up.railway.app/api/ws
# ============================================================

[build]
dockerfilePath = "Dockerfile.railway"

[deploy]
healthcheckPath = "/health"
healthcheckTimeout = 180
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3
numReplicas = 1
# Give workers 60 seconds to gracefully shutdown
terminationGracePeriodSeconds = 60
